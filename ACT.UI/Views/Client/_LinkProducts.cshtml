@model PagingExtension

@using ACT.Data.Models;
@using ACT.Core.Enums;
@using ACT.Core.Models;
@using ACT.Core.Models.Custom;
@using ACT.Core.Services;



@{
    ViewBag.ShowExport = true;
    //ViewBag.ShowCustom = true;
    //ViewBag.ShowQuickStructure = true;

    ViewBag.ViewName = "LinkProducts";

    UserModel user = User.Get();
}


@Html.Partial("_Notification")


@{
    Int32 count = Model.Start;
    List<Product> items = (List<Product>)Model.Items;
}


@if (Model == null || !items.Any())
{
    <div class="notification message-warn" style="margin-bottom: 20px;">
        There are no Products available matching your search criteria.
    </div>
}

<p>
    <table style="width:100%" border="0">
        <tr>
            <td style="width:3%">
                <label for="file">Client:</label>
            </td>
            <td style="width:15%">
                @Html.DropDownList("ClientList", "Please Select")
            </td>
            <td style="width:2%">
                @Html.ActionLink("Add", "AddProduct", new { }, new { @class = "add", @rel = "tipsyS", @title = "Add a new product?", @data_edit = "1", @data_id = 0, @data_target = "#sites" })
            </td>
            <td style="width:3%">
                &nbsp;
            </td>
            <td style="width:35%">
                &nbsp;
            </td>
            <td style="width:10%">
                &nbsp;
            </td>
        </tr>
    </table>
    <span class="loader"></span>
</p>
<table id="sites-table" class="da-table datatable-numberpaging sort fixed-header" data-fixed-header-target="#sites-table_wrapper" data-starting-point=".ap-tabs ul">
    <thead>
        <tr>
            @*<th data-name="Count">
                    #
                </th>*@
            <th data-name="Name" data-column="Name">
                Product
            </th>
            <th data-name="XCord" data-column="XCord">
                Product Name
            </th>
            <th data-name="YCord" data-column="YCord">
                Hire Rate
            </th>
            <th data-name="Address" data-column="Address">
                Issue Rate
            </th>
            <th data-name="PostalCode" data-column="PostalCode">
                Lost Rate
            </th>
            <th data-name="ContactNo" data-column="ContactNo">
                Pass-on Cost
            </th>
            <th data-name="Actions">
                Actions
            </th>
        </tr>
    </thead>

    <tbody>
        @if (Model != null && items != null && items.Count() > 0)
        {
            foreach (var item in items)
            {

                ProductPrice price = new ProductPrice();
                string hrate = "";
                string irate = "";
                string lrate = "";
                string pocost = "";
                using (ProductPriceService aservice = new ProductPriceService())
                {
                    price = aservice.Get(item.Id);
                    if (price != null)
                    {
                        hrate = price.RateUnit.ToString() + ' ' + price.Rate.ToString();
                        irate = price.RateUnit.ToString() + ' ' + price.Rate.ToString();
                        lrate = price.RateUnit.ToString() + ' ' + price.Rate.ToString();
                        pocost = price.RateUnit.ToString() + ' ' + price.Rate.ToString();

                    }
                }
                Status status = (Status)item.Status;
                String active = status.Equals(Status.Active) ? "active" : "inactive";
                String enable = status.Equals(Status.Active) ? "Disable" : "Enable";

                <tr id="tr-@item.Id-item" class="tr-@item.Id-item">

                    @*<td width="1%">
                            @count
                        </td>*@
                    <td>
                        @item.Name
                    </td>
                    <td>
                        @item.Description
                    </td>
                    <td>
                        @item.ProductPrices
                    </td>
                    <td>
                        @hrate
                    </td>
                    <td>
                        @irate
                    </td>
                    <td>
                        @lrate
                    </td>
                    <td>
                        @pocost
                    </td>                    
                    <td width="15%">
                        @Html.ActionLink("History", "HistoryDetails", new { id = item.Id }, new { @class = "info", @data_details = "1", @data_id = item.Id, @data_target = ".tr-" + item.Id + "-item" })

                        @Html.ActionLink(enable, "DeleteProduct", new { id = item.Id }, new { @class = "warn", @data_delete = "1", @data_id = item.Id, @data_target = "#tr-" + item.Id + "-item", @data_refresh_target = "#linkproducts", @rel = "tipsyE", @title = enable + " this item?" })

                        @Html.ActionLink("Edit", "EditProduct", new { id = item.Id, returnView = "Client" }, new { @class = "edit", @data_edit = "1", @data_id = item.Id, @data_target = ".tr-" + item.Id + "-item" })


                    </td>

                </tr>

                count++;
            }
        }
    </tbody>

</table>

@*@Html.Partial( "_UserCustomSearch", new ACT.Core.Models.CustomSearchModel( "User" ) )*@

@Html.Partial("_Paging")