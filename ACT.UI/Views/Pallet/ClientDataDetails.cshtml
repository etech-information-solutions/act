@model ChepLoad

@using ACT.Data.Models;

@{
    if ( ViewBag.IncludeLayout == null )
    {
        Layout = null;
    }

    ViewBag.Title = "Details";

    List<ClientLoad> clientLoads = ViewBag.ClientLoads;

    ClientLoad cl = clientLoads?.FirstOrDefault();

    ClientAuthorisation ca = ViewBag.ClientAuthorisation;

    List<ClientProduct> clientProducts = ViewBag.ClientProducts;
}

@if ( ViewBag.IncludeLayout != null )
{
    <h2>
        <img alt="" src="@Url.Content( "~/images/info.png" )" />
        <span>Load Details</span>
    </h2>
}

<div id="item-details" class="item-details" style="width: auto;">

    @if ( ViewBag.IncludeLayout == null )
    {
        <h2>
            <img alt="" src="@Url.Content( "~/images/info.png" )" />
            <span>Load Details</span>
        </h2>
    }

    <div class="left" style="width: 31%; margin-right: 3%;">

        <div class="display-label">
            Load/Shipment Number
        </div>
        <div class="display-field">
            @( cl?.LoadNumber )
        </div>

        <div class="display-label">
            Load Date
        </div>
        <div class="display-field">
            @( cl?.LoadDate?.ToString( "dd/MM/yyyy" ) )
        </div>

        <div class="display-label">
            Client Site From
        </div>
        <div class="display-field">
            @( cl?.ClientSite?.Site?.Name )
        </div>

        <div class="display-label">
            Region From
        </div>
        <div class="display-field">
            @( cl?.ClientSite?.Site?.Region?.Name )
        </div>

        <div class="display-label">
            Client Site To
        </div>
        <div class="display-field">
            @( cl?.ClientSite1?.Site?.Name )
        </div>

        <div class="display-label">
            Region To
        </div>
        <div class="display-field">
            @( cl?.ClientSite1?.Site?.Region?.Name )
        </div>

        <div class="display-label">
            Customer Group
        </div>
        <div class="display-field">
            @( cl?.Client?.ClientGroups?.FirstOrDefault()?.Group?.Description )
        </div>

        <div class="display-label">
            Delivery Note
        </div>
        <div class="display-field">
            @( cl?.DeliveryNote )
        </div>

        <div class="display-label">
            Invoice Number
        </div>
        <div class="display-field">
            @( cl?.ChepInvoiceNo )
        </div>

        <div class="display-label">
            Sales Order Number
        </div>
        <div class="display-field">
            @( cl?.ReferenceNumber )
        </div>

        <div class="display-label">
            Primary/Second
        </div>
        <div class="display-field">
            &nbsp;
        </div>

        <div class="display-label">
            Depot STO Number
        </div>
        <div class="display-field">
            &nbsp;
        </div>

    </div>

    <div class="left" style="width: 31%; margin-right: 3%;">

        <div class="display-label">
            CHEP ACC NO/GLID
        </div>
        <div class="display-field">
            @( Model?.DocketNumber )
        </div>

        <div class="display-label">
            Delivery Date
        </div>
        <div class="display-field">
            @( Model?.DeliveryDate )
        </div>

        <div class="display-label">
            Transporter Name
        </div>
        <div class="display-field">
            @( cl?.Transporter?.Name )
        </div>

        <div class="display-label">
            Fleet Number
        </div>
        <div class="display-field">
            &nbsp;
        </div>

        <div class="display-label">
            Vehicle Registration
        </div>
        <div class="display-field">
            @( cl?.Vehicle?.Registration )
        </div>

        <div class="display-label">
            Debtors Code
        </div>
        <div class="display-field">
            &nbsp;
        </div>

        <div class="display-label">
            Customer Account Number
        </div>
        <div class="display-field">
            @( cl?.ClientSite1?.Site?.AccountCode )
        </div>

        <div class="display-label">
            Customer Order Number
        </div>
        <div class="display-field">
            @( cl?.ReferenceNumber )
        </div>

        <div class="display-label">
            Other Reference
        </div>
        <div class="display-field">
            @( cl?.ReceiverNumber )
        </div>

        <div class="display-label">
            Load Sheet Number
        </div>
        <div class="display-field">
            &nbsp;
        </div>

        <div class="display-label">
            GRV Number
        </div>
        <div class="display-field">
            &nbsp;
        </div>

    </div>

    <div class="left" style="width: 31%;">

        <div class="display-label">
            ACT Control DOC No
        </div>
        <div class="display-field">
            &nbsp;
        </div>

        <div class="display-label">
            CHEP Exchange DOC No
        </div>
        <div class="display-field">
            @( Model?.IsExchange == true ? Model?.DocketNumber : string.Empty )
        </div>

        <div class="display-label">
            CHEP Customer THAN DOC No
        </div>
        <div class="display-field">
            @( Model?.TransactionType?.ToUpper()?.Trim() == "TRANSFER OUT" ? Model?.DocketNumber : string.Empty )
        </div>

        <div class="display-label">
            Warehouse Transfer DOC No
        </div>
        <div class="display-field">
            @( Model?.TransactionType?.ToUpper()?.Trim() == "TRANSFER IN" ? Model?.DocketNumber : string.Empty )
        </div>

        <div class="display-label">
            Debrief Document No
        </div>
        <div class="display-field">
            &nbsp;
        </div>

        <div class="display-label">
            Pallet Return Slip No
        </div>
        <div class="display-field">
            @( Model?.DocketNumber )
        </div>

        <div class="display-label">
            Pallet Return Date
        </div>
        <div class="display-field">
            @( Model?.EffectiveDate?.ToString( "dd/MM/yyyy" ) )
        </div>

        <div class="display-label">
            Authorization Code
        </div>
        <div class="display-field">
            @( ca?.Code )
        </div>

        <div class="display-label">
            Authorized By
        </div>
        <div class="display-field">
            @( ca?.User?.Name ) @( ca?.User?.Surname )
        </div>

        <div class="display-label">
            CHEP Comp No
        </div>
        <div class="display-field">
            @( cl?.ChepCompensationNo  ) <!-- Will be captured by user in edit mode -->
        </div>

        <div class="display-label">
            GRV Date
        </div>
        <div class="display-field">
            &nbsp;
        </div>

    </div>

    <div class="clear" style="border-bottom: 1px dashed #ccc; margin: 20px 0; height: 0;">&nbsp;</div>

    <div class="left" style="width: 60%; padding-right: 20px; border-right: 1px solid #ddd;">

        @{
            decimal width = 100 / clientProducts.NullableCount();
        }

        <div class="display-label">
            Equipment
        </div>
        <div class="display-field">

            @if ( clientProducts.NullableAny() )
            {
                <table style="width: 100%;">
                    <thead>
                        <tr>
                            @foreach ( var item in clientProducts )
                            {
                                string active = ( item.Equipment?.Trim()?.ToLower() == Model?.EquipmentCode?.Trim()?.ToLower() ) ? "active" : "";

                                <td class="@active" style="width: @width%">
                                    @item.Equipment
                                </td>
                            }
                        </tr>
                    </thead>
                </table>
            }

        </div>

        <div class="display-label">
            Quantity
        </div>
        <div class="display-field">

            @if ( clientProducts.NullableAny() )
            {
                <table style="width: 100%;">
                    <thead>
                        <tr>
                            @foreach ( var item in clientProducts )
                            {
                                bool isCurrent = ( item.Equipment?.Trim()?.ToLower() == Model?.EquipmentCode?.Trim()?.ToLower() );
                                string active = isCurrent ? "active" : "";

                                <td class="@active" style="width: @width%">
                                    @( isCurrent ? cl?.OriginalQuantity : 0 )
                                </td>
                            }
                        </tr>
                    </thead>
                </table>
            }

        </div>

        <div class="display-label">
            Returned/Transferred Qty
        </div>
        <div class="display-field">

            @if ( clientProducts.NullableAny() )
            {
                <table style="width: 100%;">
                    <thead>
                        <tr>
                            @foreach ( var item in clientProducts )
                            {
                                bool isCurrent = ( item.Equipment?.Trim()?.ToLower() == Model?.EquipmentCode?.Trim()?.ToLower() );
                                string active = isCurrent ? "active" : "";

                                <td class="@active" style="width: @width%">
                                    @( isCurrent ? cl?.ReturnQty : 0 )
                                </td>
                            }
                        </tr>
                    </thead>
                </table>
            }

        </div>

        <div class="display-label">
            Debrief Qty
        </div>
        <div class="display-field">

            @if ( clientProducts.NullableAny() )
            {
                <table style="width: 100%;">
                    <thead>
                        <tr>
                            @foreach ( var item in clientProducts )
                            {
                                bool isCurrent = ( item.Equipment?.Trim()?.ToLower() == Model?.EquipmentCode?.Trim()?.ToLower() );
                                string active = isCurrent ? "active" : "";

                                <td class="@active" style="width: @width%">
                                    @( isCurrent ? cl?.DebriefQty : 0 )
                                </td>
                            }
                        </tr>
                    </thead>
                </table>
            }

        </div>

        <div class="display-label">
            Transporter Liable
        </div>
        <div class="display-field">

            @if ( clientProducts.NullableAny() )
            {
                <table style="width: 100%;">
                    <thead>
                        <tr>
                            @foreach ( var item in clientProducts )
                            {
                                bool isCurrent = ( item.Equipment?.Trim()?.ToLower() == Model?.EquipmentCode?.Trim()?.ToLower() );
                                string active = isCurrent ? "active" : "";

                                <td class="@active" style="width: @width%">
                                    @( isCurrent ? cl?.TransporterLiableQty : 0 )
                                </td>
                            }
                        </tr>
                    </thead>
                </table>
            }

        </div>

        <div class="display-label">
            Admin Movement
        </div>
        <div class="display-field">

            @if ( clientProducts.NullableAny() )
            {
                <table style="width: 100%;">
                    <thead>
                        <tr>
                            @foreach ( var item in clientProducts )
                            {
                                bool isCurrent = ( item.Equipment?.Trim()?.ToLower() == Model?.EquipmentCode?.Trim()?.ToLower() );
                                string active = isCurrent ? "active" : "";

                                <td class="@active" style="width: @width%">
                                    @( isCurrent ? cl?.AdminMovement : 0 )
                                </td>
                            }
                        </tr>
                    </thead>
                </table>
            }

        </div>

        <div class="display-label">
            Outstanding Qty at Customer
        </div>
        <div class="display-field">

            @if ( clientProducts.NullableAny() )
            {
                <table style="width: 100%;">
                    <thead>
                        <tr>
                            @foreach ( var item in clientProducts )
                            {
                                bool isCurrent = ( item.Equipment?.Trim()?.ToLower() == Model?.EquipmentCode?.Trim()?.ToLower() );
                                string active = isCurrent ? "active" : "";

                                <td class="@active" style="width: @width%">
                                    @( isCurrent ? cl?.OutstandingQty : 0 )
                                </td>
                            }
                        </tr>
                    </thead>
                </table>
            }

        </div>

    </div>

    <div class="right" style="width: 35%;">

        <div class="display-label">
            Document Type
        </div>
        <div class="display-field">
            @( Model?.IsExchange == true ? "EXCHANGE CUSTOMER" : "" )
        </div>

        <div class="display-label">
            Load Type
        </div>
        <div class="display-field">
            @( !string.IsNullOrEmpty( cl?.PCNNumber ) ? "PCN" : "PRN" )
        </div>

        <div class="display-label">
            Comment
        </div>
        <div class="display-field">
            @( cl?.ClientLoadComment )
        </div>

        <div class="display-label">
            Pallet Notes
        </div>
        <div class="display-field">
            @( cl?.ClientLoadNotes )
        </div>

    </div>

    <div class="clear" style="border-bottom: 1px dashed #ccc; margin: 20px 0; height: 0;">&nbsp;</div>

    @if ( ViewBag.IncludeLayout == null )
    {
        <p>
            @if ( ViewBag.CanEdit == true )
            {
                <span>
                    @Html.ActionLink( "Edit", "EditClientData", new { id = Model?.Id }, new { @class = "edit", @data_edit = "1", @data_id = Model?.Id, @data_target = "#tr-" + Model?.Id + "-item" } )
                </span>
                <span style="padding: 0 5px;">/</span>
            }
            @if ( ViewBag.IncludeLayout == null )
            {
                <a data-cancel="1" data-target="#item-details" data-remove="tr.edit">Cancel</a>
            }
        </p>
    }

    @if ( ViewBag.IncludeLayout != null )
    {
        <div class="back-to-list">
            @Html.ActionLink( "Back to List", "Index" )
        </div>
    }

</div>
